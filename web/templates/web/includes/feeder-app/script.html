<script>
    let feeder = JSON.parse(`{{feeder_s|escapejs}}`)
    // let circuint_breaher=JSON.parse(`{{circuint_breaher_s|escapejs}}`)
    let feeder_app_data = {
        feeder: feeder,
        refresh_interval: 1000,
        // circuint_breaher:circuint_breaher,
    }
</script>
<script>
    let feeder_app = new Vue({
        el: "#feeder-app",
        data: feeder_app_data,
        mounted: function () {
        },
        methods: {
            start: function () {
                this.get_feeder()

                setTimeout(() => {
                    this.start()
                }, this.refresh_interval)
            },
            get_feeder: function () {
                let url = "{% url 'web:get_feeder' %}"
                let payload = {
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                    feeder_id: this.feeder.id
                }
                let posting = $.post(url, payload)
                posting.done((data) => {
                    // console.log(data.feeder.v_a)
                    if (data.result === 'SUCCEED') {
                        feeder_app.feeder = data.feeder
                        let value = {
                            i_a: data.feeder.i_a,
                            i_b: data.feeder.i_b,
                            i_c: data.feeder.i_c,
                        }


                        current_transformer_app.values.reverse()
                        current_transformer_app.values.push(value)
                        current_transformer_app.values.reverse()
                        current_transformer_app.update_values()
                        drawCurrentLinearChart()

                        current_transformer_app.values_i_a.reverse()
                        current_transformer_app.values_i_a.push(data.feeder.i_a)
                        current_transformer_app.values_i_a.reverse()



                        current_transformer_app.values_i_b.reverse()
                        current_transformer_app.values_i_b.push(data.feeder.i_b)
                        current_transformer_app.values_i_b.reverse()



                        current_transformer_app.values_i_c.reverse()
                        current_transformer_app.values_i_c.push(data.feeder.i_c)
                        current_transformer_app.values_i_c.reverse()



                        // voltage
                        value = {
                            v_a: data.feeder.v_a,
                            v_b: data.feeder.v_b,
                            v_c: data.feeder.v_c,
                        }

                        voltage_transformer_app.values.reverse()
                        voltage_transformer_app.values.push(value)
                        voltage_transformer_app.values.reverse()
                        voltage_transformer_app.update_values()
                        drawVoltageLinearChart()

                        voltage_transformer_app.values_v_a.reverse()
                        voltage_transformer_app.values_v_a.push(data.feeder.v_a)
                        voltage_transformer_app.values_v_a.reverse()



                        voltage_transformer_app.values_v_b.reverse()
                        voltage_transformer_app.values_v_b.push(data.feeder.v_b)
                        voltage_transformer_app.values_v_b.reverse()



                        voltage_transformer_app.values_v_c.reverse()
                        voltage_transformer_app.values_v_c.push(data.feeder.v_c)
                        voltage_transformer_app.values_v_c.reverse()


                    }
                })
            }

        }
    })
</script>